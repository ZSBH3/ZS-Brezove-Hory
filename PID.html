<!DOCTYPE html>
<html lang="cs">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
<title>Informaƒçn√≠ tabule ‚Äî Z≈† B≈ôezov√© Hory</title>

<!-- Fonts & Icons -->
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;500;700&family=Roboto+Condensed:wght@400;700&display=swap" rel="stylesheet">
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">

<style>
/* ================== THEME (zachov√°no) ================== */
:root{
  --bg1:#08272d; --bg2:#0e3b46; --accent:#ff8a3d;
  --glass:rgba(255,255,255,0.04); --card:#0b2530; --muted:#9fb0bd;
  --radius:18px; --gap:18px; --border:1px solid rgba(255,255,255,0.06);
}
*{box-sizing:border-box}
html,body{height:100%;margin:0;background:linear-gradient(135deg,var(--bg1),var(--bg2));color:#eaf2f5;font-family:'Poppins',sans-serif}
body{display:flex;align-items:center;justify-content:center;padding:18px}

/* ================== CANVAS ================== */
.canvas{
  width:100%; height:100%; max-width:2200px; max-height:1350px;
  display:grid;
  grid-template-rows: auto 1fr auto;
  gap:var(--gap);
}

/* ================== TOP BAR ================== */
.topbar{
  display:flex; align-items:center; justify-content:space-between; gap:16px;
  padding:16px 22px; border-radius:26px;
  background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
  box-shadow:0 20px 60px rgba(1,8,12,0.6), inset 0 1px 0 rgba(255,255,255,0.02);
  border:var(--border);
}
.title{display:flex;align-items:center;gap:14px}
.logo{
  width:72px;height:72px;border-radius:12px;background:linear-gradient(135deg,#00b3a6,#045a63);
  display:flex;align-items:center;justify-content:center;font-weight:700;font-size:26px;color:white;
  box-shadow:0 6px 18px rgba(0,0,0,0.5);
}
.school-name{font-size:28px;font-weight:700;letter-spacing:0.6px;color:#ffefdc;text-shadow:0 3px 20px rgba(0,0,0,0.4)}
.meta{color:var(--muted);font-size:13px}

/* ================== GRID ================== */
.grid{
  display:grid; gap:var(--gap);
  grid-template-columns: 1.2fr 1fr 1fr;
  grid-template-rows: 1fr 1fr;
  min-height:0;
}

/* ================== CARD ================== */
.card{
  background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
  border-radius: var(--radius);
  padding:18px;
  box-shadow: 0 10px 40px rgba(1,8,12,0.5);
  border:var(--border);
  display:flex; flex-direction:column; gap:12px; min-height:140px; overflow:hidden;
}
.card-header{display:flex;align-items:center;gap:12px}
.card-header .icon{font-size:26px;color:var(--accent);text-shadow:0 0 14px rgba(255,138,61,0.15)}
.card-header h3{margin:0;font-size:18px;color:#ffdcbc}

/* ================== CLOCK + LESSON ================== */
.clockWrap{display:grid;grid-template-columns:1fr;gap:12px}
.clock-main{display:flex;align-items:center;gap:18px}
#clock-time{font-size:48px;font-weight:700;letter-spacing:1px;text-shadow:0 6px 18px rgba(0,0,0,0.45)}
#clock-date{color:var(--muted);font-size:16px}
.badge{background:var(--accent);color:#081018;padding:6px 10px;border-radius:10px;font-weight:700;box-shadow:0 8px 30px rgba(0,0,0,0.6)}

.lessonBox{display:grid;grid-template-columns: 1.1fr auto;gap:12px;align-items:center}
.lessonText{display:flex;flex-direction:column;gap:6px}
.lessonTitle{font-size:18px;font-weight:700}
.lessonSub{font-size:14px;color:var(--muted)}
.progressRow{display:flex;align-items:center;gap:12px}
.progressShell{flex:1;height:14px;border-radius:999px;background:rgba(255,255,255,0.06);position:relative;overflow:hidden}
.progressBar{position:absolute;left:0;top:0;bottom:0;width:0%;background:linear-gradient(90deg,#ff8a3d,#ffc08a);border-radius:999px}
.progressInfo{display:flex;gap:16px;font-family:'Roboto Condensed',sans-serif}
.progressInfo div{font-size:14px;color:#ffdcbc}

/* ================== WEATHER ================== */
.weatherGrid{display:grid;grid-template-columns:1fr 1fr 1fr;gap:12px;align-items:stretch}
.wCard{background:rgba(255,255,255,0.03);border:var(--border);border-radius:12px;padding:12px;display:flex;gap:12px;align-items:center}
.wIcon{font-size:30px}
.wMain{display:flex;flex-direction:column;gap:4px}
.wTemp{font-size:18px;font-weight:700}
.wSub{font-size:13px;color:var(--muted)}
#small-weather{display:flex;gap:12px;align-items:center}
#small-weather .w-icon{font-size:26px}
#small-weather .w-main{font-size:16px;font-weight:600}

/* ================== DEPARTURES ================== */
.departures{display:flex;flex-direction:column;gap:10px;min-height:0;overflow:auto}
.stopBlock{background:rgba(255,255,255,0.04);border:var(--border);border-radius:12px;padding:10px}
.stopHead{display:flex;align-items:center;justify-content:space-between;margin-bottom:8px}
.stopName{display:flex;align-items:center;gap:8px;font-weight:700;color:#ffdcbc}
.depRow{display:grid;grid-template-columns: 64px 1fr auto auto;gap:8px;padding:8px;border-radius:10px;background:rgba(255,255,255,0.02);font-size:14px;align-items:center}
.depRow .line{font-weight:800;letter-spacing:0.3px}
.depRow .dir{color:#eaf2f5}
.depRow .time{font-weight:700;color:#ffd9b8}
.depRow .delay{font-weight:700}
.delay.plus{color:#ffb3b3}
.delay.zero{color:#9fe29f}
.delay.na{color:#d3d3d3}

/* ================== MENU ================== */
#obed{font-size:1rem;line-height:1.6;overflow:auto;padding-right:6px}
#obed h4{margin:0 0 8px 0;color:#ffd9b8}
.meal{padding:8px 10px;border-radius:10px;margin-bottom:8px;background:linear-gradient(90deg, rgba(255,255,255,0.015), rgba(255,255,255,0.01));border:1px solid rgba(255,255,255,0.02)}

/* ================== NEWS + EVENTS ================== */
.newsWrap{display:flex;gap:12px}
.newsThumb{width:160px;height:110px;border-radius:10px;background:#072a2d;background-size:cover;background-position:center;flex-shrink:0}
.newsTxt{flex:1;text-align:left;font-size:14px;color:#e6eef4}
.eventsList{display:flex;flex-direction:column;gap:8px;font-size:15px}
.eventItem{padding:8px;border-radius:10px;background:rgba(255,255,255,0.02);border:var(--border)}

/* ================== BOTTOM TICKER ================== */
.tickerWrap{
  position:relative; height:56px; border-radius:14px; border:var(--border);
  background:linear-gradient(90deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
  box-shadow:0 10px 30px rgba(0,0,0,0.4);
  display:grid; grid-template-columns: 180px 1fr; align-items:center; overflow:hidden; padding:0 0 0 10px;
}
.tickerTime{display:flex;align-items:center;gap:8px;font-weight:800}
.tickerTrack{position:relative; height:100%; overflow:hidden}
.tickerLane{white-space:nowrap; position:absolute; will-change:transform; font-size:16px; line-height:56px}
.tickerLane span{margin-right:36px}

/* ================== RESPONSIVE ================== */
@media (max-width: 1360px){
  .grid{grid-template-columns: 1fr 1fr; grid-template-rows: auto auto auto}
}
@media (max-width: 900px){
  .grid{grid-template-columns: 1fr; grid-template-rows: auto auto auto auto auto auto}
  #clock-time{font-size:38px}
}

/* utility hidden */
.hidden{display:none!important}
</style>
</head>
<body>
<div class="canvas">

  <!-- TOP BAR -->
  <div class="topbar">
    <div class="title">
      <div class="logo">≈†</div>
      <div>
        <div class="school-name">Z≈† B≈ôezov√© Hory ‚Äî Informaƒçn√≠ tabule</div>
        <div class="meta" id="meta-status">Aktualizov√°no: ‚Äî</div>
      </div>
    </div>
    <div class="meta">Nap√°jen√≠: online ‚Ä¢ Re≈æim: ve≈ôejn√° tabule</div>
  </div>

  <!-- MAIN GRID -->
  <div class="grid" id="grid">

    <!-- CLOCK + LESSON -->
    <div class="card" id="card-clock">
      <div class="card-header">
        <div class="icon"><i class="fa-regular fa-clock"></i></div>
        <div><h3>ƒåas & Hodina</h3><div class="meta">P≈ôesnost: syst√©mov√°</div></div>
      </div>

      <div class="clockWrap">
        <div class="clock-main">
          <div>
            <div id="clock-time">--:--:--</div>
            <div id="clock-date">‚Äî</div>
          </div>
          <div id="small-weather" class="badge" title="Rychl√Ω p≈ôehled poƒças√≠">
            <span class="w-icon">‚õÖ</span><span class="w-main">Naƒç√≠t√°m...</span>
          </div>
          <div id="nameday" class="badge">Sv√°tek: ‚Äî</div>
        </div>

        <div class="lessonBox">
          <div class="lessonText">
            <div class="lessonTitle" id="lesson-title">‚Äî</div>
            <div class="lessonSub" id="lesson-sub">‚Äî</div>
            <div class="progressRow">
              <div class="progressShell"><div class="progressBar" id="progress-bar"></div></div>
              <div class="progressInfo">
                <div id="progress-left">Zb√Ωv√°: ‚Äî</div>
                <div id="progress-end">Konec: ‚Äî</div>
              </div>
            </div>
          </div>
          <div class="badge" id="lesson-state">‚Äî</div>
        </div>
      </div>
    </div>

    <!-- WEATHER -->
    <div class="card" id="card-weather">
      <div class="card-header">
        <div class="icon"><i class="fa-solid fa-cloud-sun"></i></div>
        <div><h3>Poƒças√≠</h3><div class="meta">Aktu√°ln√≠ + 2 dny</div></div>
      </div>
      <div class="weatherGrid">
        <div class="wCard">
          <div class="wIcon" id="w0-icon">‚õÖ</div>
          <div class="wMain">
            <div class="wTemp" id="w0-temp">‚Äî</div>
            <div class="wSub" id="w0-sub">‚Äî</div>
          </div>
        </div>
        <div class="wCard">
          <div class="wIcon" id="w1-icon">‚õÖ</div>
          <div class="wMain">
            <div class="wTemp" id="w1-temp">‚Äî</div>
            <div class="wSub" id="w1-sub">Z√≠tra</div>
          </div>
        </div>
        <div class="wCard">
          <div class="wIcon" id="w2-icon">‚õÖ</div>
          <div class="wMain">
            <div class="wTemp" id="w2-temp">‚Äî</div>
            <div class="wSub" id="w2-sub">Poz√≠t≈ô√≠</div>
          </div>
        </div>
      </div>
    </div>

    <!-- DEPARTURES -->
    <div class="card" id="card-deps">
      <div class="card-header">
        <div class="icon"><i class="fa-solid fa-bus"></i></div>
        <div><h3>Odjezdy PID</h3><div class="meta">Autobusy ‚Äî N√°mƒõst√≠ & Domov senior≈Ø (do 20 min)</div></div>
      </div>
      <div class="departures" id="departures">
        <div class="meta">Naƒç√≠t√°m odjezdy...</div>
      </div>
    </div>

    <!-- MENU -->
    <div class="card" id="card-menu">
      <div class="card-header">
        <div class="icon"><i class="fa-solid fa-utensils"></i></div>
        <div><h3>Dne≈°n√≠ obƒõd</h3><div class="meta">Zdroj: zsbrezovehory.cz</div></div>
      </div>
      <div id="obed"><em>Naƒç√≠t√°m j√≠deln√≠ƒçek...</em></div>
    </div>

    <!-- EVENTS -->
    <div class="card" id="card-events">
      <div class="card-header">
        <div class="icon"><i class="fa-regular fa-calendar-days"></i></div>
        <div><h3>Kalend√°≈ô akc√≠</h3><div class="meta">Nejbli≈æ≈°√≠ ud√°losti</div></div>
      </div>
      <div class="eventsList" id="events">
        <div class="eventItem">03. 11. ‚Äî Exkurze do Planet√°ria</div>
        <div class="eventItem">11. 11. ‚Äî Den otev≈ôen√Ωch dve≈ô√≠</div>
        <div class="eventItem">20. 12. ‚Äî V√°noƒçn√≠ koncert</div>
      </div>
    </div>

    <!-- NEWS -->
    <div class="card" id="card-news">
      <div class="card-header">
        <div class="icon"><i class="fa-solid fa-newspaper"></i></div>
        <div><h3>Aktuality</h3><div class="meta">Novinky ze ≈°koly</div></div>
      </div>
      <div class="newsWrap">
        <div class="newsThumb" id="news-thumb" style="background-image:url('https://images.unsplash.com/photo-1523050854058-8df90110c9f1?q=80&w=800&auto=format&fit=crop');"></div>
        <div class="newsTxt">
          <h4 style="margin:0 0 6px 0;color:#ffdcbc">St≈ôedo≈°kolsk√Ω atletick√Ω poh√°r ve znamen√≠ gymnazist≈Ø</h4>
          <p style="margin:0">≈†koln√≠ dru≈æstvo dos√°hlo skvƒõl√Ωch v√Ωsledk≈Ø. Podrobnosti najdete na webu ≈°koly.</p>
          <ul style="margin:10px 0 0 18px;line-height:1.6">
            <li>Nov√© lavice v 7.A a 7.B</li>
            <li>Od 1. 11. zaƒç√≠n√° krou≈æek robotiky</li>
            <li>P≈ôihl√°≈°ky na ly≈æa≈ôsk√Ω v√Ωcvik do 30. 11.</li>
          </ul>
        </div>
      </div>
    </div>

  </div>

  <!-- BOTTOM TICKER -->
  <div class="tickerWrap">
    <div class="tickerTime"><i class="fa-regular fa-clock"></i><span id="ticker-time">--:--</span></div>
    <div class="tickerTrack">
      <div class="tickerLane" id="ticker-lane">
        <span>Ve ƒçtvrtek 29. ≈ô√≠jna se bude od 9:40 ve velk√© tƒõlocviƒçnƒõ konat tradiƒçn√≠ p≈ôed√°v√°n√≠ anglick√Ωch certifik√°t≈Ø.</span>
        <span>Pros√≠me ≈æ√°ky 7.A a 7.B: nov√© lavice ‚Äî neniƒçit, dƒõkujeme!</span>
        <span>Krou≈æek robotiky startuje 1. 11., p≈ôihl√°≈°ky ve ≈°koln√≠ kancel√°≈ôi.</span>
        <span>Ly≈æa≈ôsk√Ω v√Ωcvik: p≈ôihl√°≈°ky do 30. 11.</span>
      </div>
    </div>
  </div>

</div>

<script>
/* ================== KONFIG ================== */
const REFRESH_MIN = 10; // celkov√Ω refresh (poƒças√≠, j√≠deln√≠ƒçek, sv√°tek)
const SCHOOL_MENU_URL = "https://zsbrezovehory.cz/jidelni-listek/";
const PROXY_RAW = "https://api.allorigins.win/raw?url="; // pro j√≠deln√≠ƒçek

/* ================== UTIL ================== */
const $ = sel => document.querySelector(sel);
function setMetaStatus(){ $('#meta-status').textContent = 'Aktualizov√°no: ' + new Date().toLocaleTimeString('cs-CZ',{hour:'2-digit',minute:'2-digit',second:'2-digit'}) }
function pad2(n){return n<10?'0'+n:n}
function fmtTime(d){return pad2(d.getHours())+':'+pad2(d.getMinutes())}
function secondsToMinSec(s){ const m=Math.floor(s/60), sec=s%60; return `${m} min ${pad2(sec)} s` }
function parseHM(hm){ const [h,m]=hm.split(':').map(x=>parseInt(x,10)); return {h,m, total:h*60+m}; }

/* ================== TICKER (plynul√Ω RTL) ================== */
let tickerX = 0;
function initTicker(){
  const lane = $('#ticker-lane');
  const base = lane.innerHTML;
  // duplikace obsahu pro plynulou smyƒçku
  lane.innerHTML = base + base + base;
  function step(){
    tickerX -= 0.4; // rychlost (pomalej≈°√≠, ƒçiteln√©)
    const w = lane.scrollWidth / 3; // ≈°√≠≈ôka jednoho bloku
    if(-tickerX >= w) tickerX += w; // reset po jednom bloku
    lane.style.transform = `translateX(${tickerX}px)`;
    requestAnimationFrame(step);
  }
  requestAnimationFrame(step);
}

/* ================== HODINY + LEKCE ================== */
const DAY_PLAN = (()=> {
  const items = [];
  function addBlock(title,startH,startM,durMin,isBreak){
    const start = {h:startH,m:startM};
    const endMin = startH*60+startM+durMin;
    const end = {h:Math.floor(endMin/60), m:endMin%60};
    items.push({title, start, end, isBreak, durMin});
  }
  // 0. hod 7:00-7:45
  addBlock("0. hodina",7,0,45,false);
  addBlock("Mal√° p≈ôest√°vka",7,45,15,true);
  // 1. hod 8:00-8:45
  addBlock("1. hodina",8,0,45,false);
  addBlock("Mal√° p≈ôest√°vka",8,45,10,true);
  // 2. hod 8:55-9:40
  addBlock("2. hodina",8,55,45,false);
  addBlock("Velk√° p≈ôest√°vka",9,40,20,true);
  // 3. hod 10:00-10:45
  addBlock("3. hodina",10,0,45,false);
  addBlock("Mal√° p≈ôest√°vka",10,45,10,true);
  // 4. hod 10:55-11:40
  addBlock("4. hodina",10,55,45,false);
  addBlock("Mal√° p≈ôest√°vka",11,40,10,true);
  // 5. hod 11:50-12:35
  addBlock("5. hodina",11,50,45,false);
  addBlock("Mal√° p≈ôest√°vka",12,35,10,true);
  // 6. hod 12:45-13:30
  addBlock("6. hodina",12,45,45,false);
  addBlock("Mal√° p≈ôest√°vka",13,30,10,true);
  // 7. hod 13:40-14:25
  addBlock("7. hodina",13,40,45,false);
  addBlock("Mal√° p≈ôest√°vka",14,25,10,true);
  // 8. hod 14:35-15:20
  addBlock("8. hodina",14,35,45,false);
  addBlock("Mal√° p≈ôest√°vka",15,20,10,true);
  // 9. hod 15:30-16:15
  addBlock("9. hodina",15,30,45,false);
  return items;
})();

function updateClock(){
  const d=new Date();
  $('#clock-time').textContent=d.toLocaleTimeString('cs-CZ',{hour:'2-digit',minute:'2-digit',second:'2-digit'});
  $('#clock-date').textContent=d.toLocaleDateString('cs-CZ',{weekday:'long',year:'numeric',month:'long',day:'numeric'});
  $('#ticker-time').textContent=d.toLocaleTimeString('cs-CZ',{hour:'2-digit',minute:'2-digit'});
}
setInterval(updateClock,1000); updateClock();

/* urƒçen√≠ aktu√°ln√≠ho bloku + progress */
function updateLesson(){
  const now = new Date();
  const nowMin = now.getHours()*60 + now.getMinutes();
  let current = null;
  for(const b of DAY_PLAN){
    const s = b.start.h*60 + b.start.m;
    const e = b.end.h*60 + b.end.m;
    if(nowMin >= s && nowMin < e){ current = {...b, sMin:s, eMin:e}; break; }
  }
  let title, sub, left, endt, pct, state;
  if(current){
    title = current.title;
    sub = (current.isBreak?'P≈ôest√°vka':'V√Ωuka') + ` ‚Ä¢ ${pad2(current.start.h)}:${pad2(current.start.m)} ‚Äì ${pad2(current.end.h)}:${pad2(current.end.m)}`;
    const elapsed = (nowMin*60 + now.getSeconds()) - (current.sMin*60);
    const total = (current.eMin - current.sMin)*60;
    const remain = Math.max(0,total - elapsed);
    pct = Math.min(100, Math.max(0, (elapsed/total)*100 ));
    left = `Zb√Ωv√°: ${secondsToMinSec(Math.floor(remain))}`;
    endt = `Konec: ${pad2(current.end.h)}:${pad2(current.end.m)}`;
    state = current.isBreak ? 'P≈òEST√ÅVKA' : 'HODINA';
  } else {
    title = "Mimo vyuƒçov√°n√≠";
    sub = "‚Äî";
    left = "Zb√Ωv√°: ‚Äî";
    endt = "Konec: ‚Äî";
    pct = 0; state = "VOLNO";
  }
  $('#lesson-title').textContent = title;
  $('#lesson-sub').textContent = sub;
  $('#progress-left').textContent = left;
  $('#progress-end').textContent = endt;
  $('#progress-bar').style.width = pct.toFixed(1)+'%';
  $('#lesson-state').textContent = state;
}
setInterval(updateLesson,1000); updateLesson();

/* ================== SV√ÅTEK (offline jmeniny + st√°tn√≠ sv√°tky) ================== */
/* St√°tn√≠ sv√°tky maj√≠ prioritu (vyp√≠≈°e se jejich n√°zev). */
const STATE_HOLIDAYS = {
  "01-01":"Nov√Ω rok, Den obnovy samostatn√©ho ƒçesk√©ho st√°tu",
  "05-01":"Sv√°tek pr√°ce",
  "05-08":"Den v√≠tƒõzstv√≠",
  "07-05":"Den slovansk√Ωch vƒõrozvƒõst≈Ø Cyrila a Metodƒõje",
  "07-06":"Den up√°len√≠ mistra Jana Husa",
  "09-28":"Den ƒçesk√© st√°tnosti (sv. V√°clav)",
  "10-28":"Den vzniku samostatn√©ho ƒçeskoslovensk√©ho st√°tu",
  "11-17":"Den boje za svobodu a demokracii, Mezin√°rodn√≠ den studentstva",
  "12-24":"≈†tƒõdr√Ω den",
  "12-25":"1. sv√°tek v√°noƒçn√≠",
  "12-26":"2. sv√°tek v√°noƒçn√≠"
};

/* Kompletn√≠ jmeniny (offline). Z√°pis "MM-DD=Jm√©no/Jm√©na". */
const NAMEDAYS_RAW = `
01-02=Karina
01-03=Radmila
01-04=Diana
01-05=Dalimil
01-06=Ka≈°par, Melichar, Baltazar
01-07=Vilma
01-08=ƒåestm√≠r
01-09=Vladan
01-10=B≈ôetislav
01-11=Bohdana
01-12=Pravoslav
01-13=Edita
01-14=Radovan
01-15=Alice
01-16=Ctirad
01-17=Drahoslav
01-18=Vladislav
01-19=Doubravka
01-20=Ilona
01-21=Bƒõla
01-22=Slavom√≠r
01-23=Zdenƒõk
01-24=Milena
01-25=Milo≈°
01-26=Zora
01-27=Ingrid
01-28=Ot√Ωlie
01-29=Zdislava
01-30=Robin
01-31=Marika
02-01=Hynek
02-02=Nela
02-03=Bla≈æej
02-04=Jarmila
02-05=Dobromila
02-06=Vanda
02-07=Veronika
02-08=Milada
02-09=Apolena
02-10=Mojm√≠r
02-11=Bo≈æena
02-12=Slavƒõna
02-13=Vƒõnceslav
02-14=Valent√Ωn
02-15=Ji≈ôina
02-16=Ljuba
02-17=Miloslava
02-18=Gizela
02-19=Patrik
02-20=Old≈ôich
02-21=Lenka
02-22=Petr
02-23=Svatopluk
02-24=Matƒõj
02-25=Liliana
02-26=Dorota
02-27=Alexandr
02-28=Lum√≠r
02-29=Horym√≠r
03-01=Bed≈ôich
03-02=Ane≈æka
03-03=Kamil
03-04=Stela
03-05=Kazim√≠r
03-06=Miroslav
03-07=Tom√°≈°
03-08=Gabriela
03-09=Franti≈°ka
03-10=Viktorie
03-11=Andƒõla
03-12=≈òeho≈ô
03-13=R≈Ø≈æena
03-14=R√∫t, Matylda
03-15=Ida
03-16=Elena, Herbert
03-17=Vlastimil
03-18=Eduard
03-19=Josef
03-20=Svƒõtlana
03-21=Radek
03-22=Leona
03-23=Ivona
03-24=Gabriel
03-25=Mari√°n
03-26=Emanuel
03-27=Dita
03-28=So≈àa
03-29=Ta≈•√°na
03-30=Arno≈°t
03-31=Kvido
04-01=Hugo
04-02=Erika
04-03=Richard
04-04=Ivana
04-05=Miroslava
04-06=Vendula
04-07=He≈ôman, Herm√≠na
04-08=Ema
04-09=Du≈°an
04-10=Darja
04-11=Izabela
04-12=Julius
04-13=Ale≈°
04-14=Vincenc
04-15=Anast√°zie
04-16=Irena
04-17=Rudolf
04-18=Val√©rie
04-19=Rostislav
04-20=Marcela
04-21=Alexandra
04-22=Ev≈æenie
04-23=Vojtƒõch
04-24=Ji≈ô√≠
04-25=Marek
04-26=Oto
04-27=Jaroslav
04-28=Vlastislav
04-29=Robert
04-30=Blahoslav
05-01=Sv√°tek pr√°ce
05-02=Zikmund
05-03=Alexej
05-04=Kvƒõtoslav
05-05=Klaudie
05-06=Radoslav
05-07=Stanislav
05-08=Den v√≠tƒõzstv√≠
05-09=Ctibor
05-10=Bla≈æena
05-11=Svatava
05-12=Pankr√°c
05-13=Serv√°c
05-14=Bonif√°c
05-15=≈Ωofie
05-16=P≈ôemysl
05-17=Aneta
05-18=Nata≈°a
05-19=Ivo
05-20=Zby≈°ek
05-21=Monika
05-22=Emil
05-23=Vladim√≠r
05-24=Jana
05-25=Viola
05-26=Filip
05-27=Valdemar
05-28=Vil√©m
05-29=Maxmili√°n
05-30=Ferdinand
05-31=Kamila
06-01=Laura
06-02=Jarmil
06-03=Tamara
06-04=Dalibor
06-05=Dobroslav
06-06=Norbert
06-07=Iveta
06-08=Medard
06-09=Stanislava
06-10=Gita
06-11=Bruno
06-12=Antonie
06-13=Anton√≠n
06-14=Roland
06-15=V√≠t
06-16=Zbynƒõk
06-17=Adolf
06-18=Milan
06-19=Leo≈°
06-20=Kvƒõta
06-21=Alois
06-22=Pavla
06-23=Zde≈àka
06-24=Jan
06-25=Ivan
06-26=Adriana
06-27=Ladislav
06-28=Lubom√≠r
06-29=Petr a Pavel
06-30=≈†√°rka
07-01=Jaroslava
07-02=Patricie
07-03=Radom√≠r
07-04=Prokop
07-05=Cyril a Metodƒõj
07-06=Mistr Jan Hus
07-07=Bohuslava
07-08=Nora
07-09=Drahoslava
07-10=Libu≈°e, Am√°lie
07-11=Olga
07-12=Bo≈ôek
07-13=Mark√©ta
07-14=Karol√≠na
07-15=Jind≈ôich
07-16=Lubo≈°
07-17=Martina
07-18=Drahom√≠ra
07-19=ƒåenƒõk
07-20=Ilja
07-21=V√≠tƒõzslav
07-22=Magdal√©na
07-23=Libor
07-24=Krist√Ωna
07-25=Jakub
07-26=Anna
07-27=Vƒõroslav
07-28=Viktor
07-29=Marta
07-30=Bo≈ôivoj
07-31=Ign√°c
08-01=Oskar
08-02=Gustav
08-3=Milu≈°e
08-04=Dominik
08-05=Kristi√°n
08-06=Old≈ôi≈°ka
08-07=Lada
08-08=Sobƒõslav
08-09=Roman
08-10=Vav≈ôinec
08-11=Zuzana
08-12=Kl√°ra
08-13=Alena
08-14=Alan
08-15=Hana
08-16=J√°chym
08-17=Petra
08-18=Helena
08-19=Ludv√≠k
08-20=Bernard
08-21=Johana
08-22=Bohuslav
08-23=Sandra
08-24=Bartolomƒõj
08-25=Radim
08-26=Ludƒõk
08-27=Otakar
08-28=August√Ωn
08-29=Evel√≠na
08-30=Vladƒõna
08-31=Pavl√≠na
09-01=Linda, Samuel
09-02=Ad√©la
09-03=Bronislav
09-04=Jind≈ôi≈°ka
09-05=Boris
09-06=Boleslav
09-07=Regina
09-08=Mariana
09-09=Daniela
09-10=Irma
09-11=Denisa
09-12=Marie
09-13=Lubor
09-14=Radka
09-15=Jolana
09-16=Ludmila
09-17=Nadƒõ≈æda
09-18=Kry≈°tof
09-19=Zita
09-20=Oleg
09-21=Matou≈°
09-22=Darina
09-23=Berta
09-24=Jarom√≠r
09-25=Zlata
09-26=Andrea
09-27=Jon√°≈°
09-28=V√°clav
09-29=Michal
09-30=Jeron√Ωm
10-01=Igor
10-02=Ol√≠vie
10-03=Bohumil
10-04=Franti≈°ek
10-05=Eli≈°ka
10-06=Hanu≈°
10-07=Just√Ωna
10-08=Vƒõra
10-09=≈†tefan, S√°ra
10-10=Marina
10-11=Andriana
10-12=Marcel
10-13=Ren√°ta
10-14=Ag√°ta
10-15=Tereza
10-16=Havel
10-17=Hedvika
10-18=Luk√°≈°
10-19=Michaela
10-20=Vendel√≠n
10-21=Brigita
10-22=Sabina
10-23=Teodor
10-24=Nina
10-25=Be√°ta
10-26=Erik
10-27=≈†arlota
10-28=Vznik ƒåSR
10-29=Silvie
10-30=Tade√°≈°
10-31=≈†tƒõp√°nka
11-01=Felix
11-02=Pam√°tka zesnul√Ωch (Du≈°iƒçky)
11-03=Hubert
11-04=Karel
11-05=Miriam
11-06=Libƒõna
11-07=Saskie
11-08=Bohum√≠r
11-09=Bohdan
11-10=Ev≈æen
11-11=Martin
11-12=Benedikt
11-13=Tibor
11-14=S√°va
11-15=Leopold
11-16=Otmar
11-17=Mahulena (Den student≈Ø)
11-18=Romana
11-19=Al≈æbƒõta
11-20=Nikola
11-21=Albert
11-22=Cec√≠lie
11-23=Klement
11-24=Em√≠lie
11-25=Kate≈ôina
11-26=Artur
11-27=Xenie
11-28=Ren√©
11-29=Zina
11-30=Ond≈ôej
12-01=Iva
12-02=Blanka
12-03=Svatoslav
12-04=Barbora
12-05=Jitka
12-06=Mikul√°≈°
12-07=Ambro≈æ, Benjam√≠n
12-08=Kvƒõtoslava
12-09=Vratislav
12-10=Julie
12-11=Dana
12-12=Simona
12-13=Lucie
12-14=L√Ωdie
12-15=Radana
12-16=Alb√≠na
12-17=Daniel
12-18=Miloslav
12-19=Ester
12-20=Dagmar
12-21=Nat√°lie
12-22=≈†imon
12-23=Vlasta
12-24=Adam a Eva (≈†tƒõdr√Ω den)
12-25=1. sv√°tek v√°noƒçn√≠
12-26=≈†tƒõp√°n (2. sv√°tek v√°noƒçn√≠)
12-27=≈Ωaneta
12-28=Bohumila
12-29=Judita
12-30=David
12-31=Silvestr
`.trim().split(/\n+/).reduce((acc,row)=>{
  const [key,val] = row.split('=');
  if(key && val) acc[key.trim()] = val.trim();
  return acc;
}, {});

function updateNameday(){
  const now = new Date();
  const key = pad2(now.getMonth()+1) + '-' + pad2(now.getDate());
  // st√°tn√≠ sv√°tek m√° prioritu
  if(STATE_HOLIDAYS[key]){
    $('#nameday').textContent = 'Sv√°tek: ' + STATE_HOLIDAYS[key];
    return;
  }
  const name = NAMEDAYS_RAW[key];
  $('#nameday').textContent = 'Sv√°tek: ' + (name || '‚Äî');
}

/* ================== POƒåAS√ç (Open-Meteo) ================== */
function textWeatherIcon(code){
  if(code===0) return "‚òÄÔ∏è";
  if(code===1||code===2) return "‚õÖ";
  if(code===3) return "‚òÅÔ∏è";
  if(code===45||code===48) return "üå´Ô∏è";
  if(code>=51&&code<=67) return "üåßÔ∏è";
  if(code>=71&&code<=77) return "‚ùÑÔ∏è";
  if(code>=80&&code<=82) return "üå¶Ô∏è";
  if(code===95) return "‚õàÔ∏è";
  if(code===96||code===99) return "‚õàÔ∏è";
  return "‚õÖ";
}
function weatherText(code){
  const map={0:'Jasno',1:'Polojasno',2:'Oblaƒçno',3:'Zata≈æeno',45:'Mlha',48:'Mrznouc√≠ mlha',51:'Slab√© mrholen√≠',53:'Mrholen√≠',55:'Siln√© mrholen√≠',61:'Slab√Ω d√©≈°≈•',63:'D√©≈°≈•',65:'Siln√Ω d√©≈°≈•',71:'Sn√≠h',73:'Snƒõ≈æen√≠',75:'Siln√© snƒõ≈æen√≠',80:'P≈ôeh√°≈àky',81:'P≈ôeh√°≈àky',82:'Siln√© p≈ôeh√°≈àky',95:'Bou≈ôka',96:'Bou≈ôka s kroupami',99:'Siln√° bou≈ôka s kroupami'};
  return map[code]||'Poƒças√≠';
}
async function fetchWeather(){
  try{
    const res = await fetch("https://api.open-meteo.com/v1/forecast?latitude=49.69&longitude=14.01&current_weather=true&daily=weathercode,temperature_2m_max,temperature_2m_min&timezone=Europe%2FPrague");
    const data = await res.json();
    const cur = data.current_weather;
    const w0i = textWeatherIcon(cur.weathercode);
    $('#w0-icon').textContent = w0i;
    $('#w0-temp').textContent = `${cur.temperature.toFixed(1)} ¬∞C ‚Äî ${weatherText(cur.weathercode)}`;
    $('#w0-sub').textContent = `V√≠tr: ${cur.windspeed} km/h ‚Ä¢ Smƒõr: ${cur.winddirection}¬∞`;
    $('#small-weather .w-icon').textContent = w0i;
    $('#small-weather .w-main').textContent = `${cur.temperature.toFixed(1)} ¬∞C`;

    const dIdx = 1, d2Idx = 2;
    const dMax = data.daily.temperature_2m_max, dMin = data.daily.temperature_2m_min, dCode = data.daily.weathercode;
    const icon1 = textWeatherIcon(dCode[dIdx]), icon2 = textWeatherIcon(dCode[d2Idx]);
    $('#w1-icon').textContent = icon1;
    $('#w1-temp').textContent = `${Math.round(dMin[dIdx])}‚Ä¶${Math.round(dMax[dIdx])} ¬∞C ‚Äî ${weatherText(dCode[dIdx])}`;
    $('#w1-sub').textContent = `Z√≠tra`;

    $('#w2-icon').textContent = icon2;
    $('#w2-temp').textContent = `${Math.round(dMin[d2Idx])}‚Ä¶${Math.round(dMax[d2Idx])} ¬∞C ‚Äî ${weatherText(dCode[d2Idx])}`;
    $('#w2-sub').textContent = `Poz√≠t≈ô√≠`;
  }catch(err){
    $('#w0-temp').textContent = 'Poƒças√≠ nenahr√°no';
    $('#w1-temp').textContent = '‚Äî';
    $('#w2-temp').textContent = '‚Äî';
  }
}

/* ================== J√çDELN√çƒåEK ================== */
function sanitizeMenu(htmlStr, maxLen=300000){
  let s = htmlStr.replace(/<script[\s\S]*?<\/script>/gi,'').replace(/<style[\s\S]*?<\/style>/gi,'').replace(/<img[^>]*>/gi,'');
  s = s.replace(/<(?!\/?(p|ul|ol|li|h[1-4]|br|strong|em|b|i|a|div|span)[\s>])/gi,'');
  if(s.length>maxLen) s = s.slice(0,maxLen)+'‚Ä¶';
  s = s.replace(/<a\b([^>]*)>/gi,(m,attrs)=>{const href=(attrs.match(/href=["']?([^"'>\s]+)/i)||[])[1]||'#';return `<a href="${href}" target="_blank" style="color:#ffd9b8;text-decoration:underline">`;});
  return s;
}
async function fetchMenu(){
  try{
    const r = await fetch(PROXY_RAW + encodeURIComponent(SCHOOL_MENU_URL), {cache:'no-store'});
    if(!r.ok) throw new Error('HTTP '+r.status);
    const html = await r.text();
    const parser = new DOMParser();
    const doc = parser.parseFromString(html,'text/html');
    const sel = doc.querySelector('main, article, .entry-content, .post-content, .elementor-widget-container, .content, .wp-block-group');
    const raw = sel ? sel.innerHTML : doc.body.innerHTML;
    const safe = sanitizeMenu(raw);
    $('#obed').innerHTML = safe;
  }catch(e){
    $('#obed').innerHTML = '<em>Nelze naƒç√≠st j√≠deln√≠ƒçek (CORS/zdroj nedostupn√Ω). Zkuste pozdƒõji.</em>';
  }
}

/* ================== ODJEZDY (OFFLINE DATA, 2 ZAST√ÅVKY) ================== */
/* Filtr: jen spoje, kter√© odj√≠≈ædƒõj√≠ v intervalu [teƒè, teƒè+20 min].
   Minutu po pl√°novan√©m odjezdu automaticky zmiz√≠ (≈ôe≈°√≠ 30s interval p≈ôepoƒçtu).
*/
const OFFLINE_DEPS = [
  {
    stopName: "P≈ô√≠bram, B≈ôezov√© Hory, n√°mƒõst√≠",
    items: [
      {line:"508", headsign:"P≈ô√≠bram, Svat√° Hora", time:"06:25"},
      {line:"503", headsign:"Svat√° Hora (p≈ôes aut.n√°dr., Jir√°skovy sady)", time:"06:29"},
      {line:"503", headsign:"P≈ô√≠bram, Svat√° Hora", time:"06:30"},
      {line:"505", headsign:"Koziƒç√≠n (p≈ôes B≈ôezov√© Hory)", time:"06:44"},
      {line:"508", headsign:"P≈ô√≠bram, ≈†achetn√≠", time:"07:15"},
      {line:"505", headsign:"Jir√°skovy sady", time:"07:23"},
      {line:"503", headsign:"Svat√° Hora (p≈ôes aut.n√°dr., Jir√°skovy sady)", time:"07:24"},
      {line:"503", headsign:"P≈ô√≠bram, Svat√° Hora", time:"07:25"},
      {line:"508", headsign:"P≈ô√≠bram, B≈ôezov√© Hory", time:"07:52"},

      {line:"508", headsign:"P≈ô√≠bram, Svat√° Hora", time:"08:25"},
      {line:"503", headsign:"Svat√° Hora (p≈ôes aut.n√°dr., Jir√°skovy sady)", time:"08:34"},
      {line:"503", headsign:"P≈ô√≠bram, Svat√° Hora", time:"08:35"},

      {line:"505", headsign:"Koziƒç√≠n", time:"09:14"},
      {line:"508", headsign:"P≈ô√≠bram, Svat√° Hora", time:"09:25"},
      {line:"503", headsign:"Svat√° Hora (p≈ôes aut.n√°dr., Jir√°skovy sady)", time:"09:29"},
      {line:"503", headsign:"P≈ô√≠bram, Svat√° Hora", time:"09:30"},
      {line:"505", headsign:"Orlov (p≈ôes II. poliklinika, K Podles√≠)", time:"09:38"},

      {line:"505", headsign:"Koziƒç√≠n", time:"10:24"},
      {line:"508", headsign:"P≈ô√≠bram, Svat√° Hora", time:"10:25"},
      {line:"503", headsign:"Svat√° Hora (p≈ôes aut.n√°dr., Jir√°skovy sady)", time:"10:29"},
      {line:"503", headsign:"P≈ô√≠bram, Svat√° Hora", time:"10:30"},
      {line:"505", headsign:"aut. n√°dr. (ƒås. arm√°dy)", time:"10:48"},

      {line:"508", headsign:"P≈ô√≠bram, Svat√° Hora", time:"11:25"},
      {line:"503", headsign:"Svat√° Hora (p≈ôes aut.n√°dr., Jir√°skovy sady)", time:"11:29"},
      {line:"503", headsign:"P≈ô√≠bram, Svat√° Hora", time:"11:30"},

      {line:"508", headsign:"P≈ô√≠bram, Svat√° Hora", time:"12:15"},
      {line:"503", headsign:"Svat√° Hora (p≈ôes aut.n√°dr., Jir√°skovy sady)", time:"12:29"},
      {line:"505", headsign:"Koziƒç√≠n", time:"12:29"},
      {line:"503", headsign:"P≈ô√≠bram, Svat√° Hora", time:"12:30"},

      {line:"505", headsign:"Orlov (p≈ôes II. poliklinika, K Podles√≠)", time:"13:13"},
      {line:"508", headsign:"P≈ô√≠bram, Svat√° Hora", time:"13:15"},
      {line:"503", headsign:"Svat√° Hora (p≈ôes aut.n√°dr., Jir√°skovy sady)", time:"13:44"},
      {line:"503", headsign:"P≈ô√≠bram, Svat√° Hora", time:"13:45"},
      {line:"508", headsign:"P≈ô√≠bram, ≈†achetn√≠ (p≈ôes B≈ôezov√© Hory)", time:"13:55"},
      {line:"505", headsign:"Koziƒç√≠n", time:"14:04"},
      {line:"508", headsign:"P≈ô√≠bram, Svat√° Hora", time:"14:15"},
      {line:"505", headsign:"Orlov (p≈ôes II. poliklinika, K Podles√≠)", time:"14:23"},
      {line:"503", headsign:"Svat√° Hora", time:"14:44"},
      {line:"503", headsign:"P≈ô√≠bram, Svat√° Hora", time:"14:45"},
      {line:"508", headsign:"P≈ô√≠bram, Svat√° Hora", time:"14:50"},
      {line:"505", headsign:"Koziƒç√≠n", time:"15:09"},
      {line:"503", headsign:"Svat√° Hora", time:"15:14"},
      {line:"503", headsign:"P≈ô√≠bram, Svat√° Hora", time:"15:15"},
      {line:"508", headsign:"P≈ô√≠bram, Svat√° Hora", time:"15:25"},
      {line:"505", headsign:"Orlov (p≈ôes II. poliklinika, K Podles√≠)", time:"15:28"},
      {line:"503", headsign:"Svat√° Hora", time:"15:44"},
      {line:"503", headsign:"P≈ô√≠bram, Svat√° Hora", time:"15:45"},
      {line:"508", headsign:"P≈ô√≠bram, Svat√° Hora", time:"15:55"},
      {line:"503", headsign:"Svat√° Hora", time:"16:14"},
      {line:"505", headsign:"Koziƒç√≠n", time:"16:14"},
      {line:"503", headsign:"P≈ô√≠bram, Svat√° Hora", time:"16:15"},

      {line:"508", headsign:"P≈ô√≠bram, Svat√° Hora", time:"16:25"},
      {line:"505", headsign:"aut. n√°dr. (ƒås. arm√°dy) p≈ôes II. poliklinika", time:"16:33"},
      {line:"503", headsign:"Svat√° Hora", time:"17:14"},
      {line:"503", headsign:"P≈ô√≠bram, Svat√° Hora", time:"17:15"},
      {line:"508", headsign:"P≈ô√≠bram, Svat√° Hora", time:"17:25"},
      {line:"505", headsign:"Koziƒç√≠n", time:"17:59"},
      {line:"503", headsign:"Jir√°skovy sady", time:"18:14"},
      {line:"503", headsign:"P≈ô√≠bram, Jir√°skovy sady", time:"18:15"},
      {line:"505", headsign:"Orlov (p≈ôes II. poliklinika, K Podles√≠)", time:"18:18"}
    ]
  },
  {
    stopName: "P≈ô√≠bram, B≈ôezov√© Hory, domov senior≈Ø",
    items: [
      {line:"508", headsign:"P≈ô√≠bram, Svat√° Hora", time:"06:25"},
      {line:"503", headsign:"Svat√° Hora (p≈ôes aut.n√°dr., Jir√°skovy sady)", time:"06:29"},
      {line:"503", headsign:"P≈ô√≠bram, Svat√° Hora", time:"06:30"},
      {line:"505", headsign:"Koziƒç√≠n", time:"06:44"},
      {line:"508", headsign:"P≈ô√≠bram, ≈†achetn√≠ (p≈ôes B≈ôezov√© Hory)", time:"07:15"},
      {line:"505", headsign:"Jir√°skovy sady (p≈ôes II. poliklinika)", time:"07:23"},
      {line:"503", headsign:"Svat√° Hora (p≈ôes aut.n√°dr., Jir√°skovy sady)", time:"07:24"},
      {line:"503", headsign:"P≈ô√≠bram, Svat√° Hora", time:"07:25"},
      {line:"508", headsign:"P≈ô√≠bram, B≈ôezov√© Hory", time:"07:52"},

      {line:"508", headsign:"P≈ô√≠bram, Svat√° Hora", time:"08:25"},
      {line:"503", headsign:"Svat√° Hora (p≈ôes aut.n√°dr., Jir√°skovy sady)", time:"08:34"},
      {line:"503", headsign:"P≈ô√≠bram, Svat√° Hora", time:"08:35"},

      {line:"505", headsign:"Koziƒç√≠n", time:"09:14"},
      {line:"508", headsign:"P≈ô√≠bram, Svat√° Hora", time:"09:25"},
      {line:"503", headsign:"Svat√° Hora (p≈ôes aut.n√°dr., Jir√°skovy sady)", time:"09:29"},
      {line:"503", headsign:"P≈ô√≠bram, Svat√° Hora", time:"09:30"},
      {line:"505", headsign:"Orlov (p≈ôes II. poliklinika, K Podles√≠)", time:"09:38"},

      {line:"505", headsign:"Koziƒç√≠n", time:"10:24"},
      {line:"508", headsign:"P≈ô√≠bram, Svat√° Hora", time:"10:25"},
      {line:"503", headsign:"Svat√° Hora (p≈ôes aut.n√°dr., Jir√°skovy sady)", time:"10:29"},
      {line:"503", headsign:"P≈ô√≠bram, Svat√° Hora", time:"10:30"},
      {line:"505", headsign:"aut. n√°dr. (ƒås. arm√°dy)", time:"10:48"},

      {line:"508", headsign:"P≈ô√≠bram, Svat√° Hora", time:"11:25"},
      {line:"503", headsign:"Svat√° Hora (p≈ôes aut.n√°dr., Jir√°skovy sady)", time:"11:29"},
      {line:"503", headsign:"P≈ô√≠bram, Svat√° Hora", time:"11:30"},

      {line:"508", headsign:"P≈ô√≠bram, Svat√° Hora", time:"12:15"},
      {line:"503", headsign:"Svat√° Hora (p≈ôes aut.n√°dr., Jir√°skovy sady)", time:"12:29"},
      {line:"505", headsign:"Koziƒç√≠n", time:"12:29"},
      {line:"503", headsign:"P≈ô√≠bram, Svat√° Hora", time:"12:30"},

      {line:"505", headsign:"Orlov (p≈ôes II. poliklinika, K Podles√≠)", time:"13:13"},
      {line:"508", headsign:"P≈ô√≠bram, Svat√° Hora", time:"13:15"},
      {line:"503", headsign:"Svat√° Hora", time:"13:44"},
      {line:"503", headsign:"P≈ô√≠bram, Svat√° Hora", time:"13:45"},
      {line:"508", headsign:"P≈ô√≠bram, ≈†achetn√≠", time:"13:55"},
      {line:"505", headsign:"Koziƒç√≠n", time:"14:04"},
      {line:"508", headsign:"P≈ô√≠bram, Svat√° Hora", time:"14:15"},
      {line:"505", headsign:"Orlov (p≈ôes II. poliklinika, K Podles√≠)", time:"14:23"},
      {line:"503", headsign:"Svat√° Hora", time:"14:44"},
      {line:"503", headsign:"P≈ô√≠bram, Svat√° Hora", time:"14:45"},
      {line:"508", headsign:"P≈ô√≠bram, Svat√° Hora", time:"14:50"},
      {line:"505", headsign:"Koziƒç√≠n", time:"15:09"},
      {line:"503", headsign:"Svat√° Hora", time:"15:14"},
      {line:"503", headsign:"P≈ô√≠bram, Svat√° Hora", time:"15:15"},
      {line:"508", headsign:"P≈ô√≠bram, Svat√° Hora", time:"15:25"},
      {line:"505", headsign:"Orlov (p≈ôes II. poliklinika, K Podles√≠)", time:"15:28"},
      {line:"503", headsign:"Svat√° Hora", time:"15:44"},
      {line:"503", headsign:"P≈ô√≠bram, Svat√° Hora", time:"15:45"},
      {line:"508", headsign:"P≈ô√≠bram, Svat√° Hora", time:"15:55"},
      {line:"503", headsign:"Svat√° Hora", time:"16:14"},
      {line:"505", headsign:"Koziƒç√≠n", time:"16:14"},
      {line:"503", headsign:"P≈ô√≠bram, Svat√° Hora", time:"16:15"},

      {line:"508", headsign:"P≈ô√≠bram, Svat√° Hora", time:"16:25"},
      {line:"505", headsign:"aut. n√°dr. (ƒås. arm√°dy) p≈ôes II. poliklinika", time:"16:33"},
      {line:"503", headsign:"Svat√° Hora", time:"17:14"},
      {line:"503", headsign:"P≈ô√≠bram, Svat√° Hora", time:"17:15"},
      {line:"508", headsign:"P≈ô√≠bram, Svat√° Hora", time:"17:25"},
      {line:"505", headsign:"Koziƒç√≠n", time:"17:59"},
      {line:"503", headsign:"Jir√°skovy sady", time:"18:14"},
      {line:"503", headsign:"P≈ô√≠bram, Jir√°skovy sady", time:"18:15"},
      {line:"505", headsign:"Orlov (p≈ôes II. poliklinika, K Podles√≠)", time:"18:18"}
    ]
  }
];

function renderOfflineDepartures(){
  const wrap = $('#departures');
  wrap.innerHTML = '';
  const now = new Date();
  const nowMin = now.getHours()*60 + now.getMinutes();

  OFFLINE_DEPS.forEach(stop=>{
    const block = document.createElement('div');
    block.className='stopBlock';
    block.innerHTML = `
      <div class="stopHead">
        <div class="stopName"><i class="fa-solid fa-location-dot" style="color:var(--accent)"></i> ${stop.stopName}</div>
        <div class="meta">${fmtTime(now)}</div>
      </div>
      <div class="stopList"></div>
    `;
    const list = block.querySelector('.stopList');

    const rows = stop.items
      .map(x => {
        const t = parseHM(x.time).total;
        // posu≈à o -1 min, aby spoj v 00:00 zmizel v 00:01
        const minDiff = t - nowMin;
        return {...x, tMin:t, minDiff};
      })
      .filter(x => x.minDiff >= 0 && x.minDiff <= 20)
      .sort((a,b)=>a.tMin-b.tMin);

    if(rows.length===0){
      list.innerHTML = `<div class="meta">V nejbli≈æ≈°√≠ch 20 minut√°ch nic nejede.</div>`;
    }else{
      rows.forEach(d=>{
        const depH = Math.floor(d.tMin/60), depM = d.tMin%60;
        const timeStr = `${pad2(depH)}:${pad2(depM)}`;
        const row = document.createElement('div');
        row.className='depRow';
        row.innerHTML = `
          <div class="line">${d.line}</div>
          <div class="dir">${d.headsign}</div>
          <div class="time">${timeStr} ‚Ä¢ za ${d.minDiff} min</div>
          <div class="delay"><span class="delay na">‚Äî</span></div>
        `;
        list.appendChild(row);
      });
    }

    wrap.appendChild(block);
  });
}

/* ================== REFRESH CYCLE ================== */
function setMetaAndTicker(){
  $('#ticker-time').textContent = new Date().toLocaleTimeString('cs-CZ',{hour:'2-digit',minute:'2-digit'});
  setMetaStatus();
}
async function refreshAll(){
  updateClock();
  updateLesson();
  updateNameday();
  fetchWeather();
  fetchMenu();
  renderOfflineDepartures();
  setMetaAndTicker();
}
refreshAll();
setInterval(refreshAll, REFRESH_MIN*60*1000);

/* init on load */
window.addEventListener('load', ()=>{
  initTicker();
  // odjezdy p≈ôepoƒç√≠t√°vat ƒçastƒõji, aby ‚Äûminutu po‚Äú zmizely
  setInterval(renderOfflineDepartures, 30*1000);
});
</script>
</body>
</html>
