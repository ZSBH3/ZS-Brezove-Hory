<!DOCTYPE html>
<html lang="cs">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Informační tabule — ZŠ Březové Hory</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;500;700&family=Roboto+Condensed:wght@400;700&display=swap" rel="stylesheet">
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">
<style>
:root{
--bg1:#08272d;
--bg2:#0e3b46;
--accent:#ff8a3d;
--glass: rgba(255,255,255,0.04);
--card:#0b2530;
--muted:#9fb0bd;
--radius:18px;
--gap:18px;
}
*{box-sizing:border-box;}
html,body{height:100%;margin:0;font-family:'Poppins',sans-serif;background:linear-gradient(135deg,var(--bg1),var(--bg2));color:#eaf2f5;}
body{display:flex;align-items:center;justify-content:center;padding:18px;}
.board{width:100%;height:100%;max-width:2200px;max-height:1300px;display:grid;grid-template-columns:1.4fr 1fr;grid-template-rows:1fr 1fr;gap:var(--gap);align-items:stretch;background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));padding:22px;border-radius:26px;box-shadow:0 20px 60px rgba(1,8,12,0.6), inset 0 1px 0 rgba(255,255,255,0.02);overflow:hidden;}
.topbar{grid-column:1/-1;display:flex;justify-content:space-between;align-items:center;gap:16px;padding:8px 16px;}
.title{display:flex;align-items:center;gap:14px;}
.logo{width:72px;height:72px;border-radius:12px;background:linear-gradient(135deg,#00b3a6,#045a63);display:flex;align-items:center;justify-content:center;font-weight:700;font-size:26px;color:white;box-shadow:0 6px 18px rgba(0,0,0,0.5);}
.school-name{font-size:28px;font-weight:700;letter-spacing:0.6px;color:#ffefdc;text-shadow:0 3px 20px rgba(0,0,0,0.4);}
.meta{color:var(--muted);font-size:13px;}
.card{background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));border-radius: var(--radius);padding:18px;box-shadow: 0 10px 40px rgba(1,8,12,0.5);border:1px solid rgba(255,255,255,0.04);display:flex;flex-direction:column;gap:10px;min-height:120px;}
.card-header{display:flex;align-items:center;gap:12px;}
.card-header .icon{font-size:28px;color:var(--accent);text-shadow:0 0 14px rgba(255,138,61,0.15);}
.card-header h3{margin:0;font-size:18px;color:#ffdcbc;}
.left-top{grid-column:1/2;grid-row:1/2;display:grid;grid-template-columns:1fr 1fr;gap:var(--gap);}
.left-bottom{grid-column:1/2;grid-row:2/3;display:grid;grid-template-columns:1fr 1fr;gap:var(--gap);}
.right-all{grid-column:2/3;grid-row:1/3;display:flex;flex-direction:column;gap:var(--gap);}
#obed{font-size:1rem;line-height:1.6;color:#eaf2f5;overflow:auto;padding-right:6px;}
#obed h4{margin:0 0 8px 0;color:#ffd9b8;}
#obed .meal{padding:8px 10px;border-radius:10px;margin-bottom:8px;background:linear-gradient(90deg, rgba(255,255,255,0.015), rgba(255,255,255,0.01));border:1px solid rgba(255,255,255,0.02);}
.clock-box{display:flex;flex-direction:column;align-items:flex-start;gap:8px;}
#clock-time{font-size:48px;font-weight:700;color:#fff; letter-spacing:1px; text-shadow:0 6px 18px rgba(0,0,0,0.45);}
#clock-date{color:var(--muted);font-size:16px;}
.progress-container{width:100%;background:rgba(255,255,255,0.05);border-radius:10px;height:26px;display:flex;align-items:center;justify-content:space-between;padding:0 10px;color:#ffdcbc;font-weight:700;font-size:14px;}
.progress-bar{height:8px;background:var(--accent);border-radius:8px;flex:1;margin:0 10px;position:relative;}
.progress-bar-fill{height:100%;background:var(--accent);border-radius:8px;width:0%;}
.ticker{grid-column:1/-1;height:38px;border-radius:10px;background:linear-gradient(90deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));display:flex;align-items:center;overflow:hidden;padding:6px 12px;border:1px solid rgba(255,255,255,0.03);}
.ticker .marquee{white-space:nowrap;display:inline-block;}
@keyframes scrollMarq{0%{transform:translateX(100%);}100%{transform:translateX(-100%);}}
.live-clock-badge{position:fixed;left:28px;bottom:28px;background:var(--accent);color:#081018;padding:10px 14px;border-radius:10px;font-weight:700;box-shadow:0 8px 30px rgba(0,0,0,0.6);z-index:40;}
@media (max-width:1200px){
.board{grid-template-columns:1fr;grid-template-rows:auto 1fr 1fr;align-items:start}
.left-top,.left-bottom{grid-column:1}
.right-all{grid-column:1}
.live-clock-badge{left:14px;bottom:14px;font-size:14px}
}
</style>
</head>
<body>
<div class="board" id="board">
  <div class="topbar">
    <div class="title">
      <div class="logo">Š</div>
      <div>
        <div class="school-name">ZŠ Březové Hory</div>
        <div class="meta" id="meta-status">Aktualizováno: —</div>
      </div>
    </div>
    <div class="meta">Napájení: online • Režim: veřejná tabule</div>
  </div>

  <div class="left-top">
    <div class="card">
      <div class="card-header">
        <div class="icon"><i class="fa-regular fa-clock"></i></div>
        <div><h3>Čas & Hodina</h3><div class="meta">Přesnost: systémová</div></div>
      </div>
      <div class="clock-box">
        <div id="clock-time">--:--:--</div>
        <div id="clock-date">—</div>
        <div id="current-holiday">Svátek: —</div>
        <div class="progress-container">
          <span id="time-left">--:--</span>
          <div class="progress-bar"><div class="progress-bar-fill" id="progress-fill"></div></div>
          <span id="time-end">--:--</span>
        </div>
      </div>
    </div>

    <div class="card">
      <div class="card-header">
        <div class="icon"><i class="fa-solid fa-bus"></i></div>
        <div><h3>Odjezdy PID</h3><div class="meta">Autobusy</div></div>
      </div>
      <div class="departures" id="departures">Načítám odjezdy...</div>
    </div>
  </div>

  <div class="left-bottom">
    <div class="card" style="min-height:260px">
      <div class="card-header">
        <div class="icon"><i class="fa-solid fa-utensils"></i></div>
        <div><h3>Dnešní oběd</h3><div class="meta">Zdroj: zsbrezovehory.cz</div></div>
      </div>
      <div id="obed"><em>Načítám jídelníček...</em></div>
    </div>

    <div class="card">
      <div class="card-header">
        <div class="icon"><i class="fa-regular fa-calendar-days"></i></div>
        <div><h3>Plán akcí</h3><div class="meta">Týdenní přehled</div></div>
      </div>
      <div id="plan">Načítám akce...</div>
    </div>
  </div>

  <div class="right-all">
    <div class="card" style="flex:1 1 auto; display:flex; flex-direction:column;">
      <div class="card-header">
        <div class="icon"><i class="fa-solid fa-newspaper"></i></div>
        <div><h3>Novinky</h3><div class="meta">Školní aktuality</div></div>
      </div>
      <div id="news">Načítám...</div>
    </div>

    <div class="card" style="height:170px;display:flex;flex-direction:column;justify-content:space-between">
      <div class="card-header">
        <div class="icon"><i class="fa-solid fa-cloud-sun"></i></div>
        <div><h3>Počasí</h3><div class="meta">Open-Meteo</div></div>
      </div>
      <div id="weather-current">Aktuální počasí: —</div>
      <div id="weather-nextdays">Zítra + pozítří: —</div>
    </div>
  </div>

  <div class="ticker" id="ticker">
    <div class="marquee" id="marq">Ve čtvrtek 30. října se budou od 9:40 rozdávat tradiční anglické certifikáty ve velké tělocvičně.</div>
  </div>

  <div class="live-clock-badge" id="top-right-time">--:--</div>
</div>

<script>
const REFRESH_MIN = 15;

// --- ČAS, HODINA/PŘESTÁVKA, PROGRESSBAR ---
const schedule=[
  {start:"07:00",end:"07:45",type:"hodina"},
  {start:"07:45",end:"08:00",type:"prest"},
  {start:"08:00",end:"08:45",type:"hodina"},
  {start:"08:45",end:"08:55",type:"prest"},
  {start:"08:55",end:"09:40",type:"hodina"},
  {start:"09:40",end:"10:00",type:"prest"},
  {start:"10:00",end:"10:45",type:"hodina"},
  {start:"10:45",end:"10:55",type:"prest"},
  {start:"10:55",end:"11:40",type:"hodina"},
  {start:"11:40",end:"11:50",type:"prest"},
  {start:"11:50",end:"12:35",type:"hodina"},
  {start:"12:35",end:"12:45",type:"prest"},
  {start:"12:45",end:"13:30",type:"hodina"},
  {start:"13:30",end:"13:40",type:"prest"},
  {start:"13:40",end:"14:25",type:"hodina"},
  {start:"14:25",end:"14:35",type:"prest"},
  {start:"14:35",end:"15:20",type:"hodina"},
  {start:"15:20",end:"15:30",type:"prest"},
  {start:"15:30",end:"16:15",type:"hodina"}
];

function pad2(n){return n.toString().padStart(2,"0");}

function updateClock(){
  const now=new Date();
  document.getElementById("clock-time").textContent=`${pad2(now.getHours())}:${pad2(now.getMinutes())}:${pad2(now.getSeconds())}`;
  document.getElementById("clock-date").textContent=now.toLocaleDateString('cs-CZ',{weekday:'long',day:'numeric',month:'long',year:'numeric'});
  document.getElementById("top-right-time").textContent=`${pad2(now.getHours())}:${pad2(now.getMinutes())}`;

  // svátek
  const holidays={"01-01":"Nový rok","10-24":"–"}; // dnes: 24.10 František nemá
  const todayKey=`${pad2(now.getMonth()+1)}-${pad2(now.getDate())}`;
  document.getElementById("current-holiday").textContent="Svátek: "+(holidays[todayKey]||"–");

  // Progressbar
  let currBlock=schedule.find(b=>{
    const [sh,sm]=b.start.split(":").map(Number);
    const [eh,em]=b.end.split(":").map(Number);
    const startDate=new Date(now.getFullYear(),now.getMonth(),now.getDate(),sh,sm);
    const endDate=new Date(now.getFullYear(),now.getMonth(),now.getDate(),eh,em);
    return now>=startDate && now<=endDate;
  });
  if(currBlock){
    const [sh,sm]=currBlock.start.split(":").map(Number);
    const [eh,em]=currBlock.end.split(":").map(Number);
    const startDate=new Date(now.getFullYear(),now.getMonth(),now.getDate(),sh,sm);
    const endDate=new Date(now.getFullYear(),now.getMonth(),now.getDate(),eh,em);
    const perc=Math.floor((now-startDate)/(endDate-startDate)*100);
    document.getElementById("progress-fill").style.width=perc+"%";

    let left=Math.floor((endDate-now)/60000);
    document.getElementById("time-left").textContent=`${Math.floor(left/60)}:${pad2(left%60)}`;
    document.getElementById("time-end").textContent=`${pad2(endDate.getHours())}:${pad2(endDate.getMinutes())}`;
  } else {
    document.getElementById("progress-fill").style.width="0%";
    document.getElementById("time-left").textContent="--:--";
    document.getElementById("time-end").textContent="--:--";
  }
}
setInterval(updateClock,1000);
updateClock();

// --- Ticker ---
const marquee=document.getElementById("marq");
marquee.style.animation="scrollMarq 15s linear infinite";

// --- Jídelníček ---
async function fetchObed(){
  try{
    const res=await fetch("https://zsbrezovehory.cz/jidelni-listek/");
    const text=await res.text();
    const parser=new DOMParser();
    const doc=parser.parseFromString(text,"text/html");
    const meals=Array.from(doc.querySelectorAll(".jeg-content-inner li")).map(li=>li.textContent);
    const obedDiv=document.getElementById("obed");
    if(meals.length>0){
      obedDiv.innerHTML="";
      meals.forEach(m=>{
        const el=document.createElement("div"); el.className="meal"; el.textContent=m;
        obedDiv.appendChild(el);
      });
    } else {document.getElementById("obed").innerHTML="<em>Jídelníček není k dispozici</em>";}
  }catch(e){document.getElementById("obed").innerHTML="<em>Chyba při načítání</em>";}
}
fetchObed();

// --- Počasí (Open-Meteo API příklad, Praha) ---
async function fetchWeather(){
  try{
    const res=await fetch("https://api.open-meteo.com/v1/forecast?latitude=49.6895&longitude=14.0106&hourly=temperature_2m,weathercode&daily=temperature_2m_max,temperature_2m_min,weathercode&current_weather=true&timezone=Europe/Prague");
    const data=await res.json();
    document.getElementById("weather-current").textContent=`Aktuální: ${data.current_weather.temperature} °C`;
    const tomorrow=data.daily.temperature_2m_max[1]+"°C / "+data.daily.temperature_2m_min[1]+"°C";
    const dayAfter=data.daily.temperature_2m_max[2]+"°C / "+data.daily.temperature_2m_min[2]+"°C";
    document.getElementById("weather-nextdays").textContent=`Zítra: ${tomorrow} | Pozítří: ${dayAfter}`;
  }catch(e){
    document.getElementById("weather-current").textContent="Aktuální počasí: —";
    document.getElementById("weather-nextdays").textContent="Zítra + pozítří: —";
  }
}
fetchWeather();

// --- Odjezdy PID (Golemio API příklad, vyžaduje TOKEN) ---
const stops=[
  {id:"52838",name:"Příbram, Březové Hory, Mariánská"},
  {id:"9739/1",name:"Příbram, Březové Hory, náměstí (A)"},
  {id:"1409175511863_MAI00278",name:"Příbram, Březové Hory, domov seniorů"}
];
const GOLE_KEY="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6NDA2NSwiaWF0IjoxNzYxMjg1NTE1LCJleHAiOjExNzYxMjg1NTE1LCJpc3MiOiJnb2xlbWlvIiwianRpIjoiYzNmYWY5MGMtMGEyMi00OWE1LWI1MDktM2NiM2YwN2NiOGU0In0.ugD7g2PQ_aLZX3Hhke3rnbxFWcmn_d_5_4BXcRH9qpw";

async function fetchDepartures(){
  const div=document.getElementById("departures");
  div.innerHTML="";
  for(const stop of stops){
    try{
      const res=await fetch(`https://api.golemio.cz/pid/input-gateway/v1/departures?stopAreaId=${encodeURIComponent(stop.id)}&maxNo=5`,{
        headers:{Authorization:`Bearer ${GOLE_KEY}`}
      });
      if(!res.ok) throw new Error("Failed");
      const data=await res.json();
      const stopDiv=document.createElement("div");
      stopDiv.innerHTML=`<strong>${stop.name}</strong>`;
      const list=document.createElement("ul");
      data.departures.forEach(d=>{
        const delay=d.delay?` (+${d.delay} min)`:"";
        const li=document.createElement("li");
        li.textContent=`${d.line} → ${d.direction} | ${d.time}${delay}`;
        list.appendChild(li);
      });
      stopDiv.appendChild(list);
      div.appendChild(stopDiv);
    }catch(e){
      const errDiv=document.createElement("div");
      errDiv.textContent=`${stop.name} — Chyba při načítání`;
      div.appendChild(errDiv);
    }
  }
}
fetchDepartures();
setInterval(fetchDepartures,60000);
</script>
</body>
</html>

